{% import 'clans/macros.html' as clans_macros with context %}

{% macro emissary_description(emissary) %}

  {% if emissary.gender.is_MALE %}
    {{emissary.race.male_text}}
  {% endif %}

  {% if emissary.gender.is_FEMALE %}
    {{emissary.race.female_text}}
  {% endif %}

{% endmacro %}


{% macro emissary_verbose(emissary, description=true, clan=none, show_place=false) %}

  {% if clan %}
    <a href="{{url('clans:show', clan.id)}}">[{{clan.abbr}}]</a>
  {% endif %}

  {% if description %}
    {{emissary_description(emissary)}}
  {% endif %}

  <a href="{{url('game:emissaries:show', emissary.id)}}">{{emissary.name}}</a>

  {% if show_place %}
    из
    <a href="{{url('game:places:show', emissary.place.id)}}">{{emissary.place.utg_name.forms[1]}}</a>
  {% endif %}

{% endmacro %}


{% macro emissary_status(emissary) %}
  {% if emissary.state.is_IN_GAME %}
    <span style="color:green;">{{emissary.state.text}}</span>
  {% else %}
    <span style="color:red;">{{emissary.state.text}} ({{emissary.remove_reason.text|lower}})</span>
  {% endif %}
{% endmacro %}



{% macro emissary_list(emissaries, powers, clans=none, show_places=false, show_status=true) %}
<table class="table table-condensed">
  <thead>
    <tr>
      <th width="40px">♥</th>
      <th>Эмиссар</th>
      {% if clans %}
      <th>Гильдия</th>
      {% endif %}

      {% if show_places %}
      <th>Город</th>
      {% endif %}

      <th>Влияние</th>

      {% if show_status %}
      <th>Статус</th>
      {% endif %}
    </tr>
  </thead>
  <tbody>
    {% for emissary in emissaries %}
    <tr>
      <td>{{emissary.health}} / {{emissary.max_health}}</td>
      <td>{{emissary_verbose(emissary)}}</td>

      {% if clans %}
      <td>{{clans_macros.clan_link(clans[emissary.clan_id])}}</td>
      {% endif %}

      {% if show_places %}
      <td><a href="{{url('game:places:show', emissary.place.id)}}">{{emissary.place.name}}</a></td>
      {% endif %}

      <td>
        <a href="{{ url('game:politic-power:history', emissary=emissary.id) }}">{{powers[emissary.id]|int}}</a>
      </td>

      {% if show_status %}
      <td>
        {{emissary_status(emissary)}}
      </td>
      {% endif %}
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endmacro %}
